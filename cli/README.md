# VersaGuard-Firewall
NIS3302信息安全科技创新课程大作业——基于内核模块的包过滤防火墙

## Compile
在主目录执行：
```shell
make
```

## Usage
- **命令行参数模式**

  ```shell
  ./VersaGuard-cli -o [option] <parameters>
  ```

  - `add`：添加规则，后接**十**个参数（默认则输入""），分别表示协议类型(tcp/udp/icmp/all)，网络接口，源IP，目标IP，源端口，目标端口，开始时间，结束时间(格式为**带引号的**"YYYY-MM-DD HH:MM:SS")，执行动作(0拦截/1通过)，备注

  - `del`：删除规则，后接**一**个参数表示要删除的规则的序号

  - `upd`：修改规则，后接**三**个参数，分别表示要修改的规则的序号，要修改哪一项参数(ptc/sip/dip/spt/dpt/stm/etm/act/rmk)，修改后的结果

  - `imp`：导入规则，后接**一**个参数表示要导入的规则文件路径

  - `exp`：导出规则，后接**一**个参数表示要导出的规则文件名

  - `rule`：打印规则

  - `write`：写规则到设备文件（需提权）

  - `help`：打印使用说明

- **交互模式**

  ```shell
  ./VersaGuard-cli
  ```

    - `0`：退出程序


    - `1`：添加规则


    - `2`：删除规则


    - `3`：修改规则


    - `4`：导入规则


    - `5`：导出规则


    - `6`：打印规则


    - `7`：写规则到设备文件（需提权）


    - `8`：使用说明

## File Structure

- `include`文件夹

  - `common.h`--定义常量和规则结构体，引入库
  - `cmd_mode.h`--声明命令行参数模式的函数
  - `interact_mode.h`--声明交互模式的函数
  - `mainfunc.h`--声明主要规则管理功能函数
  - `utils.h`--声明辅助工具函数

- `src`文件夹

  - `main.c`--主函数
  - `cmd_mode.c`--命令行参数模式
  - `interact_mode.c`--交互模式
  - `mainfunc.c`--主要规则管理功能
  - `utils.c`--辅助工具

- `build`文件夹--编译得到的目标文件

  - `main.o`
  - ......

- `configure`--可执行文件

- `Makefile`--构建脚本

- `README`--项目说明文件


## Update
- **2023.07.12** 整理文件结构。
- **2023.07.10** 在规则结构体中新增表示网络接口的interface字段。允许接口、ip和时间为空。
- **2023.07.09** 新增判断待添加规则是否已存在、待修改的规则字段是否存在、修改后的规则是否已存在、待导入文件中的规则是否有效的功能，增加端口和备注输入为空的选项，只将需要拦截的规则写入设备文件，美化输出和打印出的规则表，整理代码和文件结构。
- **2023.07.05** 增加开始与结束时间是否矛盾的验证功能。美化命令行工具的提示显示效果，对警示和错误信息等输出添加颜色以提升用户体验。将输入的ruleId对应规则不存在的可能性纳入考虑。
- **2023.07.04** 优化工具函数细节，增加对协议、IP、端口、时间格式正确性验证等功能。
- **2023.07.03** Debug完成，程序成功运行。
- **2023.07.01** 实现其余参数解析等功能函数和主函数，功能基本完善。
- **2023.06.28** 实现规则的增删改等部分函数，整理文件结构。
- **2023.06.26** 初步确定基本功能及框架。
